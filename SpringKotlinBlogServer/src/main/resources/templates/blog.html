<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <!--    <link rel="stylesheet" href="static/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="../static/css/my_css.css" th:href="@{/css/my_css.css}">
    <link rel="stylesheet" href="../static/lib/prism/prism.css" th:href="@{/lib/prism/prism.css}">
    <title>Blog Page</title>
</head>
<body>

<!-- Nav-->
<div th:replace="_fragments.html::menu(0)"></div>
<!-- contect-->
<div class="container pt-3">

    <div class="card">

        <div class="list-group list-group-flush">
            <!--            Head-->
            <div class=" list-group-item">


                <div class="blog_text_color">
                    <img src="https://onaliternote.files.wordpress.com/2016/11/wp-1480230666843.jpg"
                         class="small_img_icon_rounded m_inline_block">
                    <div href="*" class="m_inline_block  pr-1 ml-3" th:text="${blog.user?.getNickname()}">name</div>
                    <div class="m_inline_block  pr-1"><span>update:</span> <span
                            th:text="${blog.updateTime}">2020-09-25</span></div>
                    <div class="m_inline_block  pr-1"><span>views:</span><span th:text="${blog.vies}">99</span></div>
                </div>


            </div>

            <div class="list-group-item" th:if="${!blog?.firstPicture.isEmpty()}">

                <img src="https://onaliternote.files.wordpress.com/2016/11/wp-1480230666843.jpg"
                     class="img-fluid rounded" alt="Responsive image"

                     th:src="'data:image/jpeg;base64,'+${blog?.firstPicture}">
            </div>

            <div class=" list-group-item">
                <div class="text-right">
                    <div class="btn btn-info btn-sm p-1 m-1" th:text="${blog.type?.name}">SSSS</div>
                </div>


                <div class="h2 font-weight-bold text-center mt-5 mb-3 ">
                    <div th:text="${blog.title}"> Title</div>

                </div>

                <div class="text-left " th:utext="${blog.contentToHtml()}">
                    Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean
                    massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec


                </div>

                <div class="d-flex  flex-wrap mt-2">
                    <div class="btn btn-danger btn-sm p-1 m-1" th:text="${tag.name}" th:each="tag:${blog.tags}">Tag
                    </div>
                </div>

                <div class="text-center mt-2 mb-3">

                    <div class="btn btn-warning " type="button" data-toggle="modal" data-target="#exampleModalCenter">
                        Like!
                    </div>


                    <!-- Modal -->
                    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
                         aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">

                                <div class="card">
                                    <div class="center_image_container">
                                        <img src="../static/images/qr.png" class="rounded qr_code  "/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class=" list-group-item">
                <div class="row">
                    <div class="col-sm-9 footer_detail_text">
                        <div>
                            <span> Author:</span><span th:text="${blog.user?.getNickname()}">name</span>

                        </div>
                        <div>
                            <span>post date:</span> <span th:text="${blog.createTime}">2017-09-09 09:08</span>
                        </div>


                    </div>
                    <div class="col-sm-3">
                        <div class="right_image_container">
                            <img src="../static/images/qr.png" class="rounded qr_code  "/>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-0" id="commentContainer">
                <div class=" list-group-item" th:fragment="commentlist">

                    <th:block th:utext="${comments}"></th:block>
                    <!--                comment start-->

                    <!--comment end-->
                </div>
            </div>


            <div class=" list-group-item">
                <form action="*" method="post" th:action="@{/blog/comment}">
                    <input type="hidden" class="form-control"
                           name="blogID" th:value="${blog.id}">
                    <div class="form-group pt-2">

                        <textarea class="form-control " id="messageInput" rows="3"
                                  placeholder="Please input message" name="message"></textarea>
                        <div class="invalid-feedback" id="messageInvalidFeedback">
                            Looks good!
                        </div>

                    </div>


                    <div class="row  pt-2">
                        <div class="col-sm-5">
                            <div class="form-group ">

                                <input type="text" class="form-control "
                                       placeholder="Name" name="name">

                                <div class="invalid-feedback" id="nameInvalidFeedback">
                                    Looks good!
                                </div>

                            </div>
                        </div>
                        <div class="col-sm-5">
                            <div class="form-group">

                                <input type="text" class="form-control "
                                       placeholder="Email" name="email">

                                <div class="invalid-feedback" id="emailInvalidFeedback">
                                    Looks good!
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <input type="submit" class="btn btn-primary" value="Post">
                        </div>
                    </div>


                </form>
            </div>
        </div>


    </div>


</div>


<!-- footer-->
<div th:replace="_fragments.html::footer"></div>
<!---->
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<div th:replace="_fragments.html::script"></div>
<script>
    function ValidateEmail(inputText) {
        let mailformat = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
        if (inputText.value.match(mailformat)) {
            alert("Valid email address!");
            document.form1.text1.focus();
            return true;
        } else {
            alert("You have entered an invalid email address!");
            document.form1.text1.focus();
            return false;
        }
    }

    $(document).ready(function () {
        $('form').submit(function () {
            let messageTextArea = $("#messageInput")
            let nameInput = $("input[name='name']")
            let emailInput = $("input[name='email']")


            let message = messageTextArea.val().trim()
            let name = nameInput.val().trim()
            let email = emailInput.val().trim()
            console.log(messageTextArea)
            console.log(name)
            console.log(email)

            if (message === '' || name === '' || email === '') {
                console.log("error")

                if (message === '') {
                    messageTextArea.addClass('is-invalid')
                    $("#messageInvalidFeedback").text("should not empty")
                } else {
                    messageTextArea.removeClass('is-invalid')
                }

                if (name === '') {
                    nameInput.addClass('is-invalid')
                    $("#nameInvalidFeedback").text("should not empty")
                } else {
                    nameInput.removeClass('is-invalid')
                }
                if (email === '') {
                    emailInput.addClass('is-invalid')
                    $("#emailInvalidFeedback").text("should not empty")
                } else {
                    emailInput.removeClass('is-invalid')
                }
                return false
            } else {
                // data class CommentInputForm(val message: String?, val name: String?,val email: String?,val blogID:Long?)
                //cal ajax
                $("#commentContainer").load("/blog/comment", {
                    message: message,
                    name: name,
                    email: email,
                    blogID: $("[name='blogID']").val()
                }, function () {
                    messageTextArea.val('')
                    nameInput.val('')
                    emailInput.val('')
                })
                return false
            }

        })
    })
</script>


</body>
</html>
